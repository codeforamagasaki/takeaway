"use strict";var map,gl,hash,glot,PoiData={},LL={},Conf={},DataList_Targets=[];const MoreZoomMsg="ズームすると店舗が表示されます。",OvGetError="サーバーからのデータ取得に失敗しました。やり直してください。",OvServer="https://overpass.nchc.org.tw/api/interpreter",FILES=["modals.html","data/category-ja.json","data/datatables-ja.json","data/local.json"],OverPass={TAK:['node["takeaway"!="no"]["takeaway"]','way["takeaway"!="no"]["takeaway"]','node["takeaway:covid19"!="no"]["takeaway:covid19"]','way["takeaway:covid19"!="no"]["takeaway:covid19"]'],DEL:['node["delivery"!="no"]["delivery"]','way["delivery"!="no"]["delivery"]','node["delivery:covid19"!="no"]["delivery:covid19"]','way["delivery:covid19"!="no"]["delivery:covid19"]'],BKR:['node["shop"="bakery"]','way["shop"="bakery"]'],DLI:['node["shop"="deli"]','way["shop"="deli"]'],CFR:['node["shop"="confectionery"]','way["shop"="confectionery"]'],PTY:['node["shop"="pastry"]','way["shop"="pastry"]'],FST:['node["amenity"="fast_food"]','way["amenity"="fast_food"]'],CAF:['node["amenity"="cafe"]["takeaway"!="no"]["takeaway"]','way["amenity"="cafe"]["takeaway"!="no"]["takeaway"]']};$(document).ready(function(){console.log("Welcome to Takeaway.");let a=[];for(let o in FILES)a.push($.get(FILES[o]));$.when.apply($,a).always(function(){$("#Modals").html(arguments[0][0]);for(let a=1;a<=3;a++){let o=arguments[a][0];Object.keys(o).forEach(a=>{Conf[a]={},Object.keys(o[a]).forEach(e=>Conf[a][e]=o[a][e])})}DataList_Targets=Object.keys(Conf.target).filter(a=>(PoiData[a]={},Conf.target[a].list)),DisplayStatus.window_resize(),DisplayStatus.splash(!0),DisplayStatus.make_menu(),DataList.init(),console.log("initialize leaflet."),map=L.map("mapid",{center:Conf.local.DefaultCenter,zoom:Conf.local.DefaultZoom,maxZoom:20}),gl=L.mapboxGL({container:"map",attribution:Conf.local.attribution,accessToken:Conf.local.token,style:Conf.local.style}).addTo(map),map.zoomControl.setPosition("bottomright"),L.control.locate({position:"bottomright",strings:{title:"現在地を表示"},locateOptions:{maxZoom:16}}).addTo(map),L.control.scale({imperial:!1,maxWidth:200}).addTo(map),(glot=new Glottologist).import("./data/glot.json").then(()=>{glot.render()}),""==location.hash?(hash=new L.Hash(map),Marker.event_move()):hash=new L.Hash(map),$(window).resize(DisplayStatus.window_resize),map.on("moveend",Marker.event_move),map.on("zoomend",function(a){let o=map.getZoom()<Conf.local.MinZoomLevel?MoreZoomMsg:"";DisplayStatus.morezoom(o)}),map.on("styleimagemissing",function(a){var o=a.id;if(0===o.indexOf("square-rgb-")){for(var e=o.replace("square-rgb-","").split(",").map(Number),t=new Uint8Array(1),n=0;n<1;n++)for(var i=0;i<1;i++){var s=1*(1*i+n);t[s+0]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=0}map.addImage(o,{width:1,height:1,data:t})}})})});
